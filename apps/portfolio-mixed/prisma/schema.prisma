// Multi-Database Prisma Schema for Portfolio
// SQLite: Blog Comments | Postgres: Analytics & Contact | MongoDB: Projects

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// =============================================================================
// SQLITE DATABASE - Blog Comments System
// =============================================================================

model BlogComment {
  id          Int      @id @default(autoincrement())
  postSlug    String   // Which blog post (e.g., "maritime-safeguarding-future")
  authorName  String   // Commenter's name
  authorEmail String?  // Email (optional, for notifications)
  authorWebsite String? // Website (optional)
  commentText String   // The actual comment
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  ipAddress   String?  // For moderation
  isApproved  Boolean  @default(false) // Comment moderation
  parentId    Int?     // For reply threads
  
  // Self-referential relation for replies
  parent   BlogComment?  @relation("CommentReplies", fields: [parentId], references: [id])
  replies  BlogComment[] @relation("CommentReplies")
  
  @@map("blog_comments")
}

model BlogView {
  id        Int      @id @default(autoincrement())
  postSlug  String   // Which post was viewed
  viewedAt  DateTime @default(now())
  ipAddress String?
  userAgent String?
  
  @@map("blog_views")
}

// Basic Analytics using SQLite (fallback when Postgres isn't available)
model PageView {
  id        Int      @id @default(autoincrement())
  path      String   // Page path (e.g., "/", "/about", "/projects")
  viewedAt  DateTime @default(now())
  ipAddress String?
  userAgent String?
  referrer  String?
  
  @@map("page_views")
}

model ContactForm {
  id        Int      @id @default(autoincrement())
  name      String
  email     String
  subject   String?
  message   String
  createdAt DateTime @default(now())
  ipAddress String?
  status    String   @default("unread") // unread, read, replied
  
  @@map("contact_forms")
}
